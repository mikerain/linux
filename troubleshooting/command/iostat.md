**`iostat`** 的用法和常见参数示例（RHEL 8 中一般在 `sysstat` 包里）：

------

## 1. 安装

在 RHEL 8 上，`iostat` 属于 `sysstat` 工具集：

```
sudo dnf install -y sysstat
```

------

## 2. 基本用法

`iostat` 可以显示 CPU 使用率和磁盘 I/O 统计信息。
 命令格式：

```
iostat [参数] [间隔秒数] [重复次数]
```

例如：

```
iostat 2 5
```

👉 每隔 2 秒输出一次，总共输出 5 次。

------

## 3. 常见参数

### (1) **-x** ：扩展统计（推荐）

```
iostat -x 2 5
```

显示更详细的磁盘 I/O 信息，包括：

- `r/s, w/s`：每秒读写次数
- `rkB/s, wkB/s`：每秒读写 KB
- `await`：平均 I/O 等待时间（ms，越高说明磁盘性能瓶颈）
- `%util`：磁盘使用率（接近 100% 说明磁盘忙不过来）

------

### (2) **-d** ：只显示磁盘 I/O

```
iostat -d 2 5
```

只显示磁盘读写情况，不显示 CPU。

------

### (3) **-c** ：只显示 CPU

```
iostat -c 1 3
```

只显示 CPU 使用率。

------

### (4) **-m** ：以 MB 为单位显示

```
iostat -dxm 2 5
```

以 MB/s 为单位，扩展信息。

------

### (5) **-p** ：指定设备/分区

```
iostat -p sda 2 5
```

只查看 `sda` 磁盘的性能。

------

## 4. 输出解释（常见指标）

以 `iostat -x` 为例：

```
Device:   r/s   w/s rkB/s wkB/s avgrq-sz avgqu-sz await svctm %util
sda       5.0   2.0  40.0  10.0    20.0     0.1   5.2   0.4   35.0
```

- **r/s, w/s** ：每秒读写请求数
- **rkB/s, wkB/s** ：读写吞吐量（KB/s 或 MB/s）
- **avgrq-sz** ：平均每次 I/O 请求大小（扇区数）
- **avgqu-sz** ：平均队列长度（排队的 I/O 数量）
- **await** ：平均 I/O 等待时间（ms，>50ms 说明可能有瓶颈）
- **%util** ：磁盘利用率，接近 100% 时说明磁盘繁忙

------

## 5. 示例场景

- **定位磁盘瓶颈**：

```
iostat -x 1 10
```

看 `%util` 和 `await` 是否过高。

- **观察特定磁盘吞吐量**：

```
iostat -p sdb -mx 2 5
```





```
iostat -x 1
Linux 4.18.0-553.el8_10.x86_64 (localhost.localdomain) 	08/25/2025 	_x86_64_	(2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           3.27    0.03    0.17    0.01    0.01   96.50

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.03    0.41      3.02    396.81     0.00     0.00   0.24   0.94    0.34   11.66   0.00   102.98   966.90   0.60   0.03
vdb              0.00    0.00      0.02      0.00     0.00     0.00   0.00   0.00    0.04    0.00   0.00    21.65     0.00   0.12   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.04    0.00   0.00     3.14     0.00   0.29   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          47.76    0.00   26.87    0.50    1.00   23.88

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.99  836.63      7.92 833293.56     0.00     2.97   0.00   0.35    0.00   38.48  32.19     8.00   996.01   0.87  73.07
vdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          52.26    0.00   37.19    0.00    1.01    9.55

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.00 1167.00      0.00 1163077.00     0.00     1.00   0.00   0.09    0.00   11.65  13.59     0.00   996.64   0.30  34.80
vdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00


```



## 1️⃣ iostat -x 1 输出分析

### 第一段（空闲状态）

```
avg-cpu:  %user 3.27  %system 0.17  %iowait 0.01  %idle 96.50
vda: w/s=0.41, wkB/s=396.81, svctm=0.60, %util=0.03
```

- CPU 空闲 (`id=96.5%`)，磁盘几乎没压力 (`%util=0.03`)。
- 写入速度极低 (~396KB/s)，I/O 请求响应时间很短 (`svctm=0.6ms`)。
- 此时系统还未进行磁盘压测。

------

### 第二段（压力中）

```
avg-cpu: %user=47.76, %system=26.87, %iowait=0.50
vda: w/s=836.63, wkB/s=833293.56 KB/s, svctm=0.87ms, %util=73.07
```

- CPU 占用增加，系统态（`sy=26.87%`）也显著上升 → 表明磁盘 I/O 消耗了 CPU。
- 写速率非常高：约 **833 MB/s**。
- `%util=73%` → vda 设备约 3/4 时间被忙碌占用，说明 I/O 负载高。
- `w_await=38.48ms` → 磁盘请求平均等待时间 ~38ms，说明磁盘开始排队，但还在可接受范围。
- `rkB/s` 很小 → 压测主要是写操作。

------

### 第三段（压力高峰）

```
avg-cpu: %user=52.26, %system=37.19, %iowait=0
vda: w/s=1167, wkB/s=1163077 KB/s, svctm=0.30ms, %util=34.8
```

- 写速率进一步升高 (~1.1GB/s)，CPU 消耗增加。
- `%util=34.8%` 有点低，可能是因为 I/O 被缓存或批量写操作。
- `w_await=11.65ms` → 平均等待时间下降，可能数据写入被优化或使用了缓存。



```
    vmstat 1
    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
     r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
     1  0      0 543940   3084 1118932    0    0     9  1782   81   57  3  0 96  0  0
     1  0      0 727704   3084 935200    0    0     0 626312 1492  288 33 19 37 10  1
     2  0      0 965640   3084 697324    0    0     0 911820 2109  255 49 30 21  1  0
     1  0      0 553768   3084 1109108    0    0     0 757816 1595  241 38 20 32 11  1
     1  0      0 807080   3084 855860    0    0     0 945225 2181  276 49 32 18  0  0
     1  0      0 568120   3084 1094756    0    0     0 856708 1370  240 28 15 32 25  1
     1  0      0 1052908   3084 610040    0    0     0 856520 2043  296 41 30 28  0  1
```

