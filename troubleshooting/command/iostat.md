**`iostat`** çš„ç”¨æ³•å’Œå¸¸è§å‚æ•°ç¤ºä¾‹ï¼ˆRHEL 8 ä¸­ä¸€èˆ¬åœ¨ `sysstat` åŒ…é‡Œï¼‰ï¼š

------

## 1. å®‰è£…

åœ¨ RHEL 8 ä¸Šï¼Œ`iostat` å±äº `sysstat` å·¥å…·é›†ï¼š

```
sudo dnf install -y sysstat
```

------

## 2. åŸºæœ¬ç”¨æ³•

`iostat` å¯ä»¥æ˜¾ç¤º CPU ä½¿ç”¨ç‡å’Œç£ç›˜ I/O ç»Ÿè®¡ä¿¡æ¯ã€‚
 å‘½ä»¤æ ¼å¼ï¼š

```
iostat [å‚æ•°] [é—´éš”ç§’æ•°] [é‡å¤æ¬¡æ•°]
```

ä¾‹å¦‚ï¼š

```
iostat 2 5
```

ğŸ‘‰ æ¯éš” 2 ç§’è¾“å‡ºä¸€æ¬¡ï¼Œæ€»å…±è¾“å‡º 5 æ¬¡ã€‚

------

## 3. å¸¸è§å‚æ•°

### (1) **-x** ï¼šæ‰©å±•ç»Ÿè®¡ï¼ˆæ¨èï¼‰

```
iostat -x 2 5
```

æ˜¾ç¤ºæ›´è¯¦ç»†çš„ç£ç›˜ I/O ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

- `r/s, w/s`ï¼šæ¯ç§’è¯»å†™æ¬¡æ•°
- `rkB/s, wkB/s`ï¼šæ¯ç§’è¯»å†™ KB
- `await`ï¼šå¹³å‡ I/O ç­‰å¾…æ—¶é—´ï¼ˆmsï¼Œè¶Šé«˜è¯´æ˜ç£ç›˜æ€§èƒ½ç“¶é¢ˆï¼‰
- `%util`ï¼šç£ç›˜ä½¿ç”¨ç‡ï¼ˆæ¥è¿‘ 100% è¯´æ˜ç£ç›˜å¿™ä¸è¿‡æ¥ï¼‰

------

### (2) **-d** ï¼šåªæ˜¾ç¤ºç£ç›˜ I/O

```
iostat -d 2 5
```

åªæ˜¾ç¤ºç£ç›˜è¯»å†™æƒ…å†µï¼Œä¸æ˜¾ç¤º CPUã€‚

------

### (3) **-c** ï¼šåªæ˜¾ç¤º CPU

```
iostat -c 1 3
```

åªæ˜¾ç¤º CPU ä½¿ç”¨ç‡ã€‚

------

### (4) **-m** ï¼šä»¥ MB ä¸ºå•ä½æ˜¾ç¤º

```
iostat -dxm 2 5
```

ä»¥ MB/s ä¸ºå•ä½ï¼Œæ‰©å±•ä¿¡æ¯ã€‚

------

### (5) **-p** ï¼šæŒ‡å®šè®¾å¤‡/åˆ†åŒº

```
iostat -p sda 2 5
```

åªæŸ¥çœ‹ `sda` ç£ç›˜çš„æ€§èƒ½ã€‚

------

## 4. è¾“å‡ºè§£é‡Šï¼ˆå¸¸è§æŒ‡æ ‡ï¼‰

ä»¥ `iostat -x` ä¸ºä¾‹ï¼š

```
Device:   r/s   w/s rkB/s wkB/s avgrq-sz avgqu-sz await svctm %util
sda       5.0   2.0  40.0  10.0    20.0     0.1   5.2   0.4   35.0
```

- **r/s, w/s** ï¼šæ¯ç§’è¯»å†™è¯·æ±‚æ•°
- **rkB/s, wkB/s** ï¼šè¯»å†™ååé‡ï¼ˆKB/s æˆ– MB/sï¼‰
- **avgrq-sz** ï¼šå¹³å‡æ¯æ¬¡ I/O è¯·æ±‚å¤§å°ï¼ˆæ‰‡åŒºæ•°ï¼‰
- **avgqu-sz** ï¼šå¹³å‡é˜Ÿåˆ—é•¿åº¦ï¼ˆæ’é˜Ÿçš„ I/O æ•°é‡ï¼‰
- **await** ï¼šå¹³å‡ I/O ç­‰å¾…æ—¶é—´ï¼ˆmsï¼Œ>50ms è¯´æ˜å¯èƒ½æœ‰ç“¶é¢ˆï¼‰
- **%util** ï¼šç£ç›˜åˆ©ç”¨ç‡ï¼Œæ¥è¿‘ 100% æ—¶è¯´æ˜ç£ç›˜ç¹å¿™

------

## 5. ç¤ºä¾‹åœºæ™¯

- **å®šä½ç£ç›˜ç“¶é¢ˆ**ï¼š

```
iostat -x 1 10
```

çœ‹ `%util` å’Œ `await` æ˜¯å¦è¿‡é«˜ã€‚

- **è§‚å¯Ÿç‰¹å®šç£ç›˜ååé‡**ï¼š

```
iostat -p sdb -mx 2 5
```





```
iostat -x 1
Linux 4.18.0-553.el8_10.x86_64 (localhost.localdomain) 	08/25/2025 	_x86_64_	(2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           3.27    0.03    0.17    0.01    0.01   96.50

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.03    0.41      3.02    396.81     0.00     0.00   0.24   0.94    0.34   11.66   0.00   102.98   966.90   0.60   0.03
vdb              0.00    0.00      0.02      0.00     0.00     0.00   0.00   0.00    0.04    0.00   0.00    21.65     0.00   0.12   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.04    0.00   0.00     3.14     0.00   0.29   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          47.76    0.00   26.87    0.50    1.00   23.88

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.99  836.63      7.92 833293.56     0.00     2.97   0.00   0.35    0.00   38.48  32.19     8.00   996.01   0.87  73.07
vdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          52.26    0.00   37.19    0.00    1.01    9.55

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
vda              0.00 1167.00      0.00 1163077.00     0.00     1.00   0.00   0.09    0.00   11.65  13.59     0.00   996.64   0.30  34.80
vdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00
scd0             0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00


```



## 1ï¸âƒ£ iostat -x 1 è¾“å‡ºåˆ†æ

### ç¬¬ä¸€æ®µï¼ˆç©ºé—²çŠ¶æ€ï¼‰

```
avg-cpu:  %user 3.27  %system 0.17  %iowait 0.01  %idle 96.50
vda: w/s=0.41, wkB/s=396.81, svctm=0.60, %util=0.03
```

- CPU ç©ºé—² (`id=96.5%`)ï¼Œç£ç›˜å‡ ä¹æ²¡å‹åŠ› (`%util=0.03`)ã€‚
- å†™å…¥é€Ÿåº¦æä½ (~396KB/s)ï¼ŒI/O è¯·æ±‚å“åº”æ—¶é—´å¾ˆçŸ­ (`svctm=0.6ms`)ã€‚
- æ­¤æ—¶ç³»ç»Ÿè¿˜æœªè¿›è¡Œç£ç›˜å‹æµ‹ã€‚

------

### ç¬¬äºŒæ®µï¼ˆå‹åŠ›ä¸­ï¼‰

```
avg-cpu: %user=47.76, %system=26.87, %iowait=0.50
vda: w/s=836.63, wkB/s=833293.56 KB/s, svctm=0.87ms, %util=73.07
```

- CPU å ç”¨å¢åŠ ï¼Œç³»ç»Ÿæ€ï¼ˆ`sy=26.87%`ï¼‰ä¹Ÿæ˜¾è‘—ä¸Šå‡ â†’ è¡¨æ˜ç£ç›˜ I/O æ¶ˆè€—äº† CPUã€‚
- å†™é€Ÿç‡éå¸¸é«˜ï¼šçº¦ **833 MB/s**ã€‚
- `%util=73%` â†’ vda è®¾å¤‡çº¦ 3/4 æ—¶é—´è¢«å¿™ç¢Œå ç”¨ï¼Œè¯´æ˜ I/O è´Ÿè½½é«˜ã€‚
- `w_await=38.48ms` â†’ ç£ç›˜è¯·æ±‚å¹³å‡ç­‰å¾…æ—¶é—´ ~38msï¼Œè¯´æ˜ç£ç›˜å¼€å§‹æ’é˜Ÿï¼Œä½†è¿˜åœ¨å¯æ¥å—èŒƒå›´ã€‚
- `rkB/s` å¾ˆå° â†’ å‹æµ‹ä¸»è¦æ˜¯å†™æ“ä½œã€‚

------

### ç¬¬ä¸‰æ®µï¼ˆå‹åŠ›é«˜å³°ï¼‰

```
avg-cpu: %user=52.26, %system=37.19, %iowait=0
vda: w/s=1167, wkB/s=1163077 KB/s, svctm=0.30ms, %util=34.8
```

- å†™é€Ÿç‡è¿›ä¸€æ­¥å‡é«˜ (~1.1GB/s)ï¼ŒCPU æ¶ˆè€—å¢åŠ ã€‚
- `%util=34.8%` æœ‰ç‚¹ä½ï¼Œå¯èƒ½æ˜¯å› ä¸º I/O è¢«ç¼“å­˜æˆ–æ‰¹é‡å†™æ“ä½œã€‚
- `w_await=11.65ms` â†’ å¹³å‡ç­‰å¾…æ—¶é—´ä¸‹é™ï¼Œå¯èƒ½æ•°æ®å†™å…¥è¢«ä¼˜åŒ–æˆ–ä½¿ç”¨äº†ç¼“å­˜ã€‚



```
    vmstat 1
    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
     r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
     1  0      0 543940   3084 1118932    0    0     9  1782   81   57  3  0 96  0  0
     1  0      0 727704   3084 935200    0    0     0 626312 1492  288 33 19 37 10  1
     2  0      0 965640   3084 697324    0    0     0 911820 2109  255 49 30 21  1  0
     1  0      0 553768   3084 1109108    0    0     0 757816 1595  241 38 20 32 11  1
     1  0      0 807080   3084 855860    0    0     0 945225 2181  276 49 32 18  0  0
     1  0      0 568120   3084 1094756    0    0     0 856708 1370  240 28 15 32 25  1
     1  0      0 1052908   3084 610040    0    0     0 856520 2043  296 41 30 28  0  1
```



```
iostat -Ntkx 1 | tee -a $(hostname)-iostat.txt
```





```
device            r/s     w/s     rMB/s     wMB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
sdl              0.00    0.01      0.00      0.01     0.00     0.00  18.45   7.04    3.57   47.54   0.00   525.25   435.89  16.26   0.02
sdm              0.00    0.01      0.00      0.01     0.00     0.00   0.00   7.36    3.77   50.59   0.00   539.73   436.81  17.41   0.03
sdd              1.00   40.00      0.00     18.62     0.00     1.00   0.00   2.44    5.00    5.30   0.22     4.00   476.80   1.39   5.70
sdd              1.00   40.00      0.00     18.84     0.00     1.00   0.00   2.44    5.00   10.65   0.43     4.00   482.30   1.56   6.40
sdd              1.00   46.00      0.00     19.30     0.00     2.00   0.00   4.17    6.00    7.15   0.33     4.00   429.74   1.30   6.10
sdd              1.00   41.00      0.00     18.94     0.00     1.00   0.00   2.38    7.00    9.41   0.39     4.00   473.07   1.55   6.50
sdd              1.00   45.00      0.00     19.48     0.00     1.00   0.00   2.17    7.00    6.40   0.29     4.00   443.38   1.24   5.70
sdd              1.00   38.00      0.00     17.75     0.00     1.00   0.00   2.56    8.00    8.34   0.33     4.00   478.32   1.41   5.50
sdd              1.00   43.00      0.00     18.70     0.00     2.00   0.00   4.44    9.00    5.30   0.24     4.00   445.21   1.30   5.70
sdd              1.00   32.00      0.00     11.97     0.00     2.00   0.00   5.88   10.00    7.16   0.24     4.00   383.12   1.30   4.30

And we see the write await highest at 51.36ms:

Device            r/s     w/s     rMB/s     wMB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
sdh              0.00    0.02      0.00      0.01     0.00     0.00   0.80   6.58    1.01   40.15   0.00    23.57   408.42  13.72   0.02
sde              0.00    0.00      0.00      0.00     0.00     0.00   0.01  88.25    0.55   45.94   0.00    60.93    34.05   1.86   0.00
sdi              0.00    0.01      0.00      0.01     0.00     0.00   0.00   4.45    2.83   46.26   0.00   502.45   450.47  15.93   0.02
sdk              0.00    0.01      0.00      0.01     0.00     0.00   0.00   6.30    2.91   46.82   0.00   535.43   444.37  16.05   0.02
sdl              0.00    0.01      0.00      0.01     0.00     0.00  18.45   7.04    3.57   47.54   0.00   525.25   435.89  16.26   0.02
sdj              0.00    0.01      0.00      0.01     0.00     0.00  16.97   6.05    3.13   47.64   0.00   491.35   444.00  16.32   0.02
sdo              0.00    0.01      0.00      0.01     0.00     0.00   0.00   8.13    3.26   47.98   0.00   508.06   433.32  16.35   0.02
sdf              0.00    0.00      0.00      0.00     0.00     0.00   0.00  69.65    0.53   48.53   0.00    52.00    13.18   1.97   0.00
sdm              0.00    0.01      0.00      0.01     0.00     0.00   0.00   7.36    3.77   50.59   0.00   539.73   436.81  17.41   0.03
sdn              0.00    0.01      0.00      0.01     0.00     0.00   9.19   7.86    2.56   51.36   0.00   463.57   433.58  17.97   0.03

```



**Device**ï¼šè®¾å¤‡åç§°ï¼ˆå¦‚ sdd, sde ç­‰ï¼‰ã€‚

**r/s**ï¼šæ¯ç§’è¯»è¯·æ±‚æ•°ï¼ˆIOPSï¼‰ã€‚

**w/s**ï¼šæ¯ç§’å†™è¯·æ±‚æ•°ï¼ˆIOPSï¼‰ã€‚

**rMB/s**ï¼šæ¯ç§’è¯»çš„æ•°æ®é‡ï¼ˆMB/sï¼‰ã€‚

**wMB/s**ï¼šæ¯ç§’å†™çš„æ•°æ®é‡ï¼ˆMB/sï¼‰ã€‚

**rrqm/s**ï¼šæ¯ç§’åˆå¹¶çš„è¯»è¯·æ±‚æ•°ï¼ˆRead mergedï¼‰ã€‚

**wrqm/s**ï¼šæ¯ç§’åˆå¹¶çš„å†™è¯·æ±‚æ•°ï¼ˆWrite mergedï¼‰ã€‚

**%rrqm**ï¼šè¯»è¯·æ±‚åˆå¹¶æ¯”ä¾‹ = rrqm/s Ã· (r/s+rrqm/s)ã€‚

**%wrqm**ï¼šå†™è¯·æ±‚åˆå¹¶æ¯”ä¾‹ = wrqm/s Ã· (w/s+wrqm/s)ã€‚

**r_await**ï¼šå¹³å‡è¯»è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼ˆmsï¼‰ã€‚

**w_await**ï¼šå¹³å‡å†™è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼ˆmsï¼‰ã€‚

**aqu-sz**ï¼šå¹³å‡è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ï¼ˆIOs in queueï¼‰ã€‚

**rareq-sz**ï¼šå¹³å‡æ¯ä¸ªè¯»è¯·æ±‚å¤§å°ï¼ˆKBï¼‰ã€‚



æ•´ç†ä¸€ä¸ª **iostat ç£ç›˜æ€§èƒ½åˆ†æé€ŸæŸ¥è¡¨**ï¼Œç»“åˆå¸¸è§çš„ä¼ä¸šç»éªŒå€¼ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿå®šä½ç£ç›˜ I/O é—®é¢˜ã€‚

------

# ğŸ“Œ iostat ç£ç›˜æ€§èƒ½åˆ†æé€ŸæŸ¥è¡¨

| æŒ‡æ ‡                   | å«ä¹‰                    | æ­£å¸¸èŒƒå›´ï¼ˆSSD/ä¼ä¸šå­˜å‚¨ï¼‰                  | æ­£å¸¸èŒƒå›´ï¼ˆHDDï¼‰ | å¼‚å¸¸åˆ¤æ–­å‚è€ƒ                                    |
| ---------------------- | ----------------------- | ----------------------------------------- | --------------- | ----------------------------------------------- |
| **r/s, w/s**           | æ¯ç§’è¯»/å†™è¯·æ±‚æ•°ï¼ˆIOPSï¼‰ | SSD å¯è¾¾æ•°åƒï½æ•°ä¸‡                        | HDD ä¸€èˆ¬ < 200  | çªç„¶é£™é«˜å¯èƒ½æ˜¯åº”ç”¨å¼‚å¸¸æˆ–æ‰¹é‡ä»»åŠ¡                |
| **rMB/s, wMB/s**       | è¯»/å†™ååé‡ï¼ˆMB/sï¼‰     | å–å†³äºæ¥å£ï¼šSAS â‰ˆ 600 MB/s, NVMe > 2 GB/s | HDD â‰ˆ 100 MB/s  | é•¿æ—¶é—´æ¥è¿‘ç¡¬ä»¶ä¸Šé™ â†’ å¸¦å®½ç“¶é¢ˆ                   |
| **r_await, w_await**   | å¹³å‡è¯»/å†™è¯·æ±‚å»¶è¿Ÿ (ms)  | SSDï¼š0.1ï½1 ms ä¼ä¸šå­˜å‚¨ï¼š< 5 ms           | HDDï¼š5ï½20 ms   | > 20 ms åŸºæœ¬å¼‚å¸¸ï¼Œ> 50 ms ä¸¥é‡æ€§èƒ½ç“¶é¢ˆ          |
| **aqu-sz**             | å¹³å‡é˜Ÿåˆ—æ·±åº¦            | SSD < 1ï¼ˆæ­£å¸¸ï¼‰                           | HDD < 1ï¼ˆæ­£å¸¸ï¼‰ | > 2 è¡¨ç¤º I/O å †ç§¯ï¼Œ> 10 ä¸¥é‡æ‹¥å¡                |
| **rareq-sz, wareq-sz** | å¹³å‡è¯·æ±‚å¤§å° (KB)       | éšæœº I/Oï¼šâ‰ˆ 4â€“16 KB é¡ºåº I/Oï¼š> 128 KB    | ç±»ä¼¼            | çªç„¶å˜å° â†’ åº”ç”¨å˜æˆéšæœºè®¿é—®ï¼›è¿‡å¤§å¯èƒ½æ˜¯æ‰¹é‡ä»»åŠ¡ |
| **svctm**              | å¹³å‡æœåŠ¡æ—¶é—´ (ms)       | SSD < 1 ms                                | HDD â‰ˆ 5â€“15 ms   | > 20 ms è¯´æ˜è®¾å¤‡æœåŠ¡ä¸è¿‡æ¥                      |
| **%util**              | ç£ç›˜åˆ©ç”¨ç‡              | < 70%ï¼ˆå¥åº·ï¼‰                             | < 70%ï¼ˆå¥åº·ï¼‰   | > 80% é•¿æœŸé«˜è´Ÿè½½ï¼›â‰ˆ100% è¡¨ç¤ºè®¾å¤‡æ»¡è´Ÿè·          |

------

## ğŸ“Š å¿«é€Ÿåˆ¤æ–­é€»è¾‘

1. **å…ˆçœ‹ %util**

   - < 70% â†’ æ­£å¸¸

   - > 80% â†’ ç£ç›˜å¯èƒ½åœ¨ç“¶é¢ˆ

   - 100% â†’ å•ç›˜è·‘æ»¡ï¼Œå¯èƒ½éœ€è¦æ‰©å®¹æˆ–è°ƒä¼˜

2. **å†çœ‹ r_await / w_await**

   - SSD æ­£å¸¸ < 1ms
   - HDD æ­£å¸¸ < 20ms
   - è¶…è¿‡é˜ˆå€¼è¯´æ˜ I/O å»¶è¿Ÿå¤§

3. **å¯¹æ¯” aqu-sz**

   - é˜Ÿåˆ—æ·±åº¦ > 2 è¡¨ç¤ºè¯·æ±‚å †ç§¯
   - é˜Ÿåˆ—æ·±åº¦é«˜ + å»¶è¿Ÿé«˜ = **I/O æ‹¥å¡**

4. **ç»“åˆè¯·æ±‚å¤§å° rareq-sz/wareq-sz**

   - å¦‚æœè¯·æ±‚çªç„¶å˜å°ï¼ˆ4K å·¦å³ï¼‰ï¼Œè¯´æ˜å˜æˆéšæœº I/Oï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚
   - å¦‚æœå¤§éƒ¨åˆ†æ˜¯å¤§ I/Oï¼Œååé‡å°±è¦æ¥è¿‘å¸¦å®½ä¸Šé™ã€‚

------

## ğŸš¨ å¸¸è§é—®é¢˜åœºæ™¯

- **é«˜å»¶è¿Ÿ + é«˜ util** â†’ è®¾å¤‡æ€§èƒ½ä¸è¶³ / å­˜å‚¨å‹åŠ›è¿‡å¤§
- **é«˜å»¶è¿Ÿ + util ä¸é«˜** â†’ åº”ç”¨ç¨‹åºé”ç­‰å¾… / RAID æ§åˆ¶å™¨ç“¶é¢ˆ
- **aqu-sz é«˜** â†’ I/O å †ç§¯ï¼Œé˜Ÿåˆ—æ»¡
- **è¯»å†™è¯·æ±‚å¤§å°å¼‚å¸¸** â†’ åº”ç”¨è´Ÿè½½æ¨¡å¼çªå˜
