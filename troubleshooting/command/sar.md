

`ar`（System Activity Reporter）是 **sysstat 工具集**中的一个核心命令，主要用于 **收集、报告和保存 Linux 系统的性能数据**，常用于 **CPU、内存、I/O、网络、进程负载**等方面的性能监控与分析。

它可以实时查看系统性能，也可以分析 `/var/log/sa/` 中的历史数据。

------

## 🛠 常见用途

- **CPU 使用率监控**：观察 user、system、idle 等占比。
- **内存使用情况**：查看内存和 swap 的使用情况。
- **I/O 性能**：磁盘读写速度、I/O 等待情况。
- **网络性能**：数据包收发、错误统计等。
- **负载与进程**：系统负载、上下文切换、中断等。
- **历史性能分析**：调取之前保存的日志进行分析。

------

## 📌 常用参数

`sar` 的参数一般分为 **监控指标** 和 **采样控制** 两类。

### 🔹 采样控制

- `sar [interval] [count]`
  - `interval`：采样间隔（秒）
  - `count`：采样次数

例如：

```
sar 1 5
```

→ 每隔 1 秒输出一次，采样 5 次。

------

### 🔹 常见监控指标

1. **CPU 使用情况**

```
sar -u 1 5
Linux 6.12.11-100.fc40.x86_64 (qxu-thinkpadt14sgen2i.rmtcn.csb) 	09/10/2025 	_x86_64_	(8 CPU)

01:48:34 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
01:48:35 PM     all      1.88      2.38      1.25      0.00      0.00     94.50
01:48:36 PM     all      1.13      2.26      1.13      0.00      0.00     95.48
01:48:37 PM     all      0.88      2.50      1.12      0.00      0.00     95.50

```

- `-u`：CPU 使用率

- `-P ALL`：查看所有 CPU 核心

  ```
  sar -P ALL 1 3
  01:48:59 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
  01:49:00 PM     all      1.00      0.25      0.75      0.12      0.00     97.88
  01:49:00 PM       0      1.98      0.00      0.99      0.00      0.00     97.03
  01:49:00 PM       1      1.00      1.00      1.00      0.00      0.00     97.00
  01:49:00 PM       2      2.00      0.00      1.00      0.00      0.00     97.00
  01:49:00 PM       3      0.00      0.00      0.00      0.00      0.00    100.00
  01:49:00 PM       4      0.00      0.00      0.00      0.00      0.00    100.00
  01:49:00 PM       5      2.00      1.00      0.00      0.00      0.00     97.00
  01:49:00 PM       6      0.00      0.00      1.98      0.99      0.00     97.03
  01:49:00 PM       7      0.99      0.00      0.99      0.00      0.00     98.02
  ```

1. **内存使用情况**

```
sar -r 1 5

Linux 6.12.11-100.fc40.x86_64 (qxu-thinkpadt14sgen2i.rmtcn.csb) 	09/10/2025 	_x86_64_	(8 CPU)

01:47:53 PM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
01:47:54 PM    738644  23042864   7242268     22.25      6728  22690716  49431500    120.74  12423244  16322440      2288
01:47:55 PM    730992  23035212   7241904     22.25      6728  22698732  49439796    120.76  12423112  16322440      2320
01:47:56 PM    749648  23053868   7239692     22.24      6728  22682284  49423232    120.72  12422992  16322440      2244
01:47:57 PM    756132  23060352   7241400     22.24      6728  22674092  49415036    120.70  12423076  16322440      224
```

- `-r`：内存和 swap 使用情况

1. **分页情况**

```
sar -B 1 5
01:49:30 PM  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s  pgprom/s   pgdem/s
01:49:31 PM      0.00      0.00    178.00      0.00   2532.00      0.00      0.00      0.00      0.00      0.00
01:49:32 PM      0.00      8.00     52.00      0.00   4395.00      0.00      0.00      0.00      0.00      0.00
01:49:33 PM      0.00     40.00      4.00      0.00   6309.00      0.00      0.00      0.00      0.00      0.00

```

- `-B`：分页统计（major/minor faults）

1. **I/O 传输**

```
sar -b 1 5
01:49:46 PM       tps      rtps      wtps      dtps   bread/s   bwrtn/s   bdscd/s
01:49:47 PM     35.00      0.00     35.00      0.00      0.00    408.00      0.00
01:49:48 PM      7.00      0.00      7.00      0.00      0.00     72.00      0.00
01:49:49 PM     27.00      0.00     27.00      0.00      0.00    568.00      0.00
```

- `-b`：I/O 传输速率统计

1. **磁盘 I/O**

```
sar -d 1 5
01:50:00 PM       DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
01:50:01 PM   nvme0n1      3.00      0.00     12.00      0.00      4.00      0.01      2.00      0.20
01:50:01 PM      dm-0      3.00      0.00     12.00      0.00      4.00      0.01      2.00      0.20
01:50:01 PM     zram0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
```

- `-d`：每个块设备的 I/O 情况（类似 iostat）

1. **网络接口**

```
sar -n DEV 1 5
```

- `-n DEV`：查看网卡流量
- `-n TCP,ETCP`：查看 TCP 连接、错误情况

1. **进程/上下文切换**

```
sar -w 1 5
01:50:14 PM    proc/s   cswch/s
01:50:15 PM      0.00   1545.00
01:50:16 PM      0.00   1045.00
01:50:17 PM      0.00    821.00
```

- `-w`：上下文切换和进程创建情况

------

### 🔹 历史数据分析

`sar` 默认会把采样数据保存到 `/var/log/sa/` 中，文件名类似：

```
/var/log/sa/sa25
```

（25 表示日期）

查看历史数据示例：

```
sar -u -f /var/log/sa/sa25
```

→ 显示 25 号当天的 CPU 使用情况。

------

## ⚡ 常用命令总结

```
sar -u 1 5          # CPU 使用率
sar -P ALL 1 5      # 所有 CPU 核心
sar -r 1 5          # 内存和 swap 使用
sar -B 1 5          # 内存分页统计
sar -b 1 5          # I/O 传输速率
sar -d 1 5          # 磁盘 I/O
sar -n DEV 1 5      # 网络接口
sar -w 1 5          # 上下文切换/进程
sar -q 1 5          # 系统负载 (load averag
sar -S 1 5
```





**`sar` 命令的输出**为例来解读一下。假设你运行：

```
sar -u 1 3
```

输出类似：

```
Linux 5.14.0-362.el9.x86_64 (localhost)   08/26/2025  _x86_64_   (4 CPU)

12:10:35 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
12:10:36 AM     all      3.25      0.00      1.50      0.10      0.00     95.15
12:10:37 AM     all      4.00      0.00      2.20      0.05      0.00     93.75
12:10:38 AM     all      2.80      0.00      1.30      0.00      0.00     95.90
Average:        all      3.35      0.00      1.67      0.05      0.00     94.93
```

------

### 字段解释

- **CPU**
  - `all` 表示所有 CPU 的平均值，也可能显示 `0,1,2,3` 等表示单独核。
- **%user**
   用户态占用的 CPU 百分比（应用程序在非内核模式下的执行时间）。
- **%nice**
   被调整过优先级（nice 值）的进程占用的 CPU 时间。
- **%system**
   内核态（系统调用、驱动程序等）占用的 CPU 时间。
- **%iowait**
   CPU 等待 I/O（磁盘、网络等）的时间百分比，数值高说明 I/O 瓶颈严重。
- **%steal**
   虚拟化环境下，CPU 被 hypervisor “偷走”的时间。如果是物理机通常为 0。
- **%idle**
   CPU 空闲时间百分比。

------

### 如何解读

1. **CPU 利用率**
    一般 `100 - %idle` 就是总的 CPU 利用率。
    在例子中，平均 `%idle=94.93`，说明 CPU 利用率大约 5% 左右，系统很空闲。
2. **I/O 等待**
    `%iowait` 持续 >10%，说明磁盘或网络 I/O 可能是性能瓶颈。
3. **系统态过高**
    `%system` 持续很高（>30%）可能是内核、驱动或中断消耗过多。
4. **用户态过高**
    `%user` 高说明 CPU 主要消耗在应用程序计算上。
5. **虚拟化环境**
    `%steal` 持续升高，说明宿主机 CPU 资源紧张，你的虚机没有分配到足够的 CPU。



```
sar -q
Linux 6.12.11-100.fc40.x86_64 (qxu-thinkpadt14sgen2i.rmtcn.csb) 	09/06/2025 	_x86_64_	(8 CPU)

08:52:58 AM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked
09:00:00 AM         0      1422      0.69      1.03      0.71         0
09:10:00 AM         0      1353      0.18      0.54      0.65         0
Average:            0      1388      0.43      0.79      0.68         0

```

`sar -q`：显示 **队列长度和负载平均值**。

- `runq-sz`：运行队列长度（等待 CPU 的进程数）。
- `plist-sz`：进程列表大小（系统中进程总数）。
- `ldavg-1`：最近 1 分钟的平均负载。
- `ldavg-5`：最近 5 分钟的平均负载。
- `ldavg-15`：最近 15 分钟的平均负载。
- `blocked`：等待 I/O 的进程数。





```
sar -d

12:00:00 AM       DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
07:00:00 AM    dev253-65    1179.73    14379.7    106.64    0    12.28    8.29    7.02    90.52
07:00:00 AM    dev253-75      0.22      0.09        14.88    0    68.06    0.00    10.19      0.20
07:00:00 AM    dev253-76   1144.65  14378.46     91.75      0.00     12.64      7.51      6.56     90.51---------------------[1]
...
07:00:00 AM    dev253-77    1145.51    14021.13    78.49    0    12.31    8.23    7.19    90.47
07:00:00 AM    dev253-87    4.48       7.96        1.79     0     2.18     0.04   8.12      3.67
07:00:00 AM    dev253-88    1099.48    14014.73    76.7    0    12.82    7.3    6.64    90.42----------------------[2]
```

这个输出是 **`sar -d`**（磁盘 I/O 统计）的结果。
 它显示了在某个时间点上各个块设备的 I/O 使用情况。下面我逐列解释：

------

### 字段含义

```
12:00:00 AM       DEV       tps     rkB/s     wkB/s     dkB/s   areq-sz    aqu-sz     await     %util
```

- **DEV**：设备名（这里是 LVM 映射出来的设备，如 `dev253-65`）。
- **tps**：每秒 I/O 请求数（读 + 写）。
- **rkB/s**：每秒读数据量（KB/s）。
- **wkB/s**：每秒写数据量（KB/s）。
- **dkB/s**：丢弃的 KB/s（一般是 0，和 discard/TRIM 相关）。
- **areq-sz**：平均每次 I/O 请求大小（KB）。
- **aqu-sz**：平均 I/O 队列长度。
- **await**：平均 I/O 响应时间（ms），包括排队 + 处理时间。
- **%util**：设备利用率，表示设备处理 I/O 的时间占比（100% 意味着磁盘已满负荷）。

数据解释

- 每秒处理 **~1145 次 I/O**；
- 主要是 **读流量**：14378 KB/s，写入只有 ~92 KB/s；
- 平均请求大小 12.64 KB；
- 队列里平均有 7.5 个请求在排队；
- 平均等待时间 6.56 ms；
- 设备利用率 **90.51%**，说明已经接近满负荷。

👉 说明：这是一个高读负载的设备，持续 90%+ 利用率，说明磁盘已经非常繁忙。



swap 相关

```
sar -S 1 5 
Linux 6.12.11-100.fc40.x86_64 (qxu-thinkpadt14sgen2i.rmtcn.csb) 	09/10/2025 	_x86_64_	(8 CPU)

01:52:43 PM kbswpfree kbswpused  %swpused  kbswpcad   %swpcad
01:52:44 PM   8388604         0      0.00         0      0.00
01:52:45 PM   8388604         0      0.00         0      0.00
01:52:46 PM   8388604         0      0.00         0      0.00

```

**`kbswpfree`**
 空闲 swap 的 KB 数。

**`kbswpused`**
 已使用 swap 的 KB 数。

**`%swpused`**
 已使用 swap 的百分比。

**`kbswpcad`**
 “cached swap”的 KB 数（已经在内存里缓存，可以不用从磁盘 swap 读取）。

**`%swpcad`**
 已用 swap 中的 cached 百分比。