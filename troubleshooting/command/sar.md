

`ar`（System Activity Reporter）是 **sysstat 工具集**中的一个核心命令，主要用于 **收集、报告和保存 Linux 系统的性能数据**，常用于 **CPU、内存、I/O、网络、进程负载**等方面的性能监控与分析。

它可以实时查看系统性能，也可以分析 `/var/log/sa/` 中的历史数据。

------

## 🛠 常见用途

- **CPU 使用率监控**：观察 user、system、idle 等占比。
- **内存使用情况**：查看内存和 swap 的使用情况。
- **I/O 性能**：磁盘读写速度、I/O 等待情况。
- **网络性能**：数据包收发、错误统计等。
- **负载与进程**：系统负载、上下文切换、中断等。
- **历史性能分析**：调取之前保存的日志进行分析。

------

## 📌 常用参数

`sar` 的参数一般分为 **监控指标** 和 **采样控制** 两类。

### 🔹 采样控制

- `sar [interval] [count]`
  - `interval`：采样间隔（秒）
  - `count`：采样次数

例如：

```
sar 1 5
```

→ 每隔 1 秒输出一次，采样 5 次。

------

### 🔹 常见监控指标

1. **CPU 使用情况**

```
sar -u 1 5
```

- `-u`：CPU 使用率

- `-P ALL`：查看所有 CPU 核心

  ```
  sar -P ALL 1 3
  ```

1. **内存使用情况**

```
sar -r 1 5
```

- `-r`：内存和 swap 使用情况

1. **分页情况**

```
sar -B 1 5
```

- `-B`：分页统计（major/minor faults）

1. **I/O 传输**

```
sar -b 1 5
```

- `-b`：I/O 传输速率统计

1. **磁盘 I/O**

```
sar -d 1 5
```

- `-d`：每个块设备的 I/O 情况（类似 iostat）

1. **网络接口**

```
sar -n DEV 1 5
```

- `-n DEV`：查看网卡流量
- `-n TCP,ETCP`：查看 TCP 连接、错误情况

1. **进程/上下文切换**

```
sar -w 1 5
```

- `-w`：上下文切换和进程创建情况

------

### 🔹 历史数据分析

`sar` 默认会把采样数据保存到 `/var/log/sa/` 中，文件名类似：

```
/var/log/sa/sa25
```

（25 表示日期）

查看历史数据示例：

```
sar -u -f /var/log/sa/sa25
```

→ 显示 25 号当天的 CPU 使用情况。

------

## ⚡ 常用命令总结

```
sar -u 1 5          # CPU 使用率
sar -P ALL 1 5      # 所有 CPU 核心
sar -r 1 5          # 内存和 swap 使用
sar -B 1 5          # 内存分页统计
sar -b 1 5          # I/O 传输速率
sar -d 1 5          # 磁盘 I/O
sar -n DEV 1 5      # 网络接口
sar -w 1 5          # 上下文切换/进程
sar -q 1 5          # 系统负载 (load averag
```





**`sar` 命令的输出**为例来解读一下。假设你运行：

```
sar -u 1 3
```

输出类似：

```
Linux 5.14.0-362.el9.x86_64 (localhost)   08/26/2025  _x86_64_   (4 CPU)

12:10:35 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
12:10:36 AM     all      3.25      0.00      1.50      0.10      0.00     95.15
12:10:37 AM     all      4.00      0.00      2.20      0.05      0.00     93.75
12:10:38 AM     all      2.80      0.00      1.30      0.00      0.00     95.90
Average:        all      3.35      0.00      1.67      0.05      0.00     94.93
```

------

### 字段解释

- **CPU**
  - `all` 表示所有 CPU 的平均值，也可能显示 `0,1,2,3` 等表示单独核。
- **%user**
   用户态占用的 CPU 百分比（应用程序在非内核模式下的执行时间）。
- **%nice**
   被调整过优先级（nice 值）的进程占用的 CPU 时间。
- **%system**
   内核态（系统调用、驱动程序等）占用的 CPU 时间。
- **%iowait**
   CPU 等待 I/O（磁盘、网络等）的时间百分比，数值高说明 I/O 瓶颈严重。
- **%steal**
   虚拟化环境下，CPU 被 hypervisor “偷走”的时间。如果是物理机通常为 0。
- **%idle**
   CPU 空闲时间百分比。

------

### 如何解读

1. **CPU 利用率**
    一般 `100 - %idle` 就是总的 CPU 利用率。
    在例子中，平均 `%idle=94.93`，说明 CPU 利用率大约 5% 左右，系统很空闲。
2. **I/O 等待**
    `%iowait` 持续 >10%，说明磁盘或网络 I/O 可能是性能瓶颈。
3. **系统态过高**
    `%system` 持续很高（>30%）可能是内核、驱动或中断消耗过多。
4. **用户态过高**
    `%user` 高说明 CPU 主要消耗在应用程序计算上。
5. **虚拟化环境**
    `%steal` 持续升高，说明宿主机 CPU 资源紧张，你的虚机没有分配到足够的 CPU。