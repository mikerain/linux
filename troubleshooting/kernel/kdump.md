å¯åŠ¨kdump

```
systemctl enable --now kdump

```

é…ç½®æ–‡ä»¶ï¼š

/etc/kdump.conf

ä¸€èˆ¬ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶æ—¶é…ç½®ï¼Œå°†dumpæ–‡ä»¶é€šè¿‡sshå‘é€åˆ°å¦ä¸€ä¸ªä¸»æœºä¸Š



dumpæ–‡ä»¶ä½ç½®ï¼š

/var/crash



è§¦å‘dump

é€šè¿‡å°† /proc/sys/kernel/sysrq â½‚ä»¶ä¸­çš„å€¼è®¾ç½®ä¸º 1 æ¥å¯â½¤ SysRq åŠŸèƒ½

é€šè¿‡å°† /proc/sysrq-trigger â½‚ä»¶ä¸­çš„å€¼è®¾ç½®ä¸º cæ¥è§¦å‘ç³»ç»Ÿå´©æºƒã€‚

```
echo 1 > /proc/sys/kernel/sysrq
echo c > /proc/sysrq-trigger
```



dumpæ–‡ä»¶ï¼š

```
cd /var/crash/127.0.0.1-2025-08-22-02:44:42

[root@localhost 127.0.0.1-2025-08-22-02:44:42]# ls -la
total 53772
drwxr-xr-x. 2 root root       67 Aug 22 02:44 .
drwxr-xr-x. 3 root root       43 Aug 22 02:44 ..
-rw-------. 1 root root    66064 Aug 22 02:44 kexec-dmesg.log
-rw-------. 1 root root 54928072 Aug 22 02:44 vmcore
-rw-------. 1 root root    59506 Aug 22 02:44 vmcore-dmesg.txt
```



è¿™ä¸‰ä¸ªæ–‡ä»¶å°±æ˜¯ **kdump å´©æºƒè½¬å‚¨çš„æ ¸å¿ƒäº§ç‰©**ï¼Œåˆ†åˆ«æœ‰ä¸åŒç”¨é€”ã€‚

------

## 1. `kexec-dmesg.log`

- **å†…å®¹**ï¼šä¿å­˜ `kdump` ç¬¬äºŒå†…æ ¸ï¼ˆcapture kernelï¼‰å¯åŠ¨å’Œè¿è¡Œæ—¶çš„æ—¥å¿—ã€‚
- **ä½œç”¨**ï¼šå¸®åŠ©æ’æŸ¥ kdump æœ¬èº«çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š
  - kdump æ˜¯å¦æˆåŠŸé¢„ç•™äº† crashkernel å†…å­˜
  - kdump æ˜¯å¦æˆåŠŸåŠ è½½äº† initramfs
  - dump è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°é”™è¯¯
- **æŸ¥çœ‹æ–¹å¼**ï¼šç›´æ¥ `less kexec-dmesg.log`ã€‚

------

## 2. `vmcore`

- **å†…å®¹**ï¼šè¿™æ˜¯æœ€é‡è¦çš„ **å†…æ ¸å´©æºƒå†…å­˜è½¬å‚¨æ–‡ä»¶**ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰ã€‚
  - ç›¸å½“äºâ€œå‡ºäº‹æ—¶æ•´ä¸ªå†…æ ¸å†…å­˜çš„å¿«ç…§â€
  - åŒ…å«è¿›ç¨‹çŠ¶æ€ã€å†…æ ¸æ•°æ®ç»“æ„ã€è°ƒç”¨æ ˆç­‰
- **ä½œç”¨**ï¼šç”¨äºæ·±åº¦åˆ†æå´©æºƒåŸå› ï¼ˆæ¯”å¦‚å†…æ ¸ panicã€æ­»é”ã€é©±åŠ¨ Bug ç­‰ï¼‰ã€‚
- **æŸ¥çœ‹æ–¹å¼**ï¼š
   éœ€è¦é…åˆ **è°ƒè¯•å†…æ ¸ç¬¦å·æ–‡ä»¶ (vmlinux)** ä½¿ç”¨ `crash` å·¥å…·è¿›è¡Œåˆ†æã€‚

### åˆ†æç¤ºä¾‹ï¼š

1. å®‰è£…å·¥å…·ï¼š

   ```
   sudo dnf install crash kernel-debuginfo
   ```

   ï¼ˆè¦å¯ç”¨ debuginfo ä»“åº“ï¼Œä¾‹å¦‚ `subscription-manager repos --enable=rhel-8-for-x86_64-appstream-rpms --enable=rhel-8-for-x86_64-debug-rpms`ï¼‰

2. å¯åŠ¨ crash åˆ†æï¼š

   ```
   sudo crash /usr/lib/debug/lib/modules/$(uname -r)/vmlinux /var/crash/.../vmcore
   ```

3. å¸¸è§å‘½ä»¤ï¼š

   - `bt` â†’ æŸ¥çœ‹å´©æºƒè¿›ç¨‹çš„ **è°ƒç”¨æ ˆ**
   - `ps` â†’ æŸ¥çœ‹å´©æºƒæ—¶çš„ **è¿›ç¨‹åˆ—è¡¨**
   - `log` â†’ æŸ¥çœ‹å†…æ ¸æ—¥å¿—
   - `files` â†’ æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶
   - `help` â†’ crash çš„å¸®åŠ©èœå•

------

## 3. `vmcore-dmesg.txt`

- **å†…å®¹**ï¼šè¿™æ˜¯ä» `vmcore` ä¸­æå–å‡ºæ¥çš„ **å†…æ ¸å´©æºƒæ—¶çš„ dmesg æ—¥å¿—**ã€‚

- **ä½œç”¨**ï¼šå¿«é€Ÿäº†è§£å´©æºƒæ—¶çš„å†…æ ¸ä¿¡æ¯ï¼Œä¸å¿…ç«‹åˆ»ç”¨ crash å·¥å…·åˆ†æã€‚

  - ä¾‹å¦‚çœ‹åˆ° `Kernel panic - not syncing: Fatal exception`
  - å¯ä»¥å¿«é€ŸçŸ¥é“ panic çš„è§¦å‘ç‚¹ã€‚

- **æŸ¥çœ‹æ–¹å¼**ï¼š

  ```
  less vmcore-dmesg.txt
  ```

------

## ğŸ”‘ ä¸‰ä¸ªæ–‡ä»¶çš„å…³ç³»æ€»ç»“

- **kexec-dmesg.log**ï¼šdump è¿‡ç¨‹ä¸­ç¬¬äºŒå†…æ ¸çš„æ—¥å¿—ï¼ˆdump å·¥å…·è¿è¡Œæƒ…å†µï¼‰ã€‚
- **vmcore**ï¼šå†…æ ¸å†…å­˜å¿«ç…§ï¼ˆåŸå§‹æ ¸å¿ƒæ–‡ä»¶ï¼Œç”¨äº crash æ·±åº¦åˆ†æï¼‰ã€‚
- **vmcore-dmesg.txt**ï¼šä» vmcore ä¸­æå–çš„ dmesg æ—¥å¿—ï¼ˆå¿«é€ŸæŸ¥çœ‹å´©æºƒåŸå› ï¼‰ã€‚

------

âœ… **å»ºè®®å®è·µæµç¨‹**ï¼š

1. å…ˆçœ‹ `vmcore-dmesg.txt`ï¼Œå¿«é€ŸçŸ¥é“ panic çš„è§¦å‘ç‚¹ã€‚
2. å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„ä¸Šä¸‹æ–‡ï¼ˆå †æ ˆã€è¿›ç¨‹çŠ¶æ€ç­‰ï¼‰ï¼Œç”¨ `crash` åŠ è½½ `vmcore` åˆ†æã€‚
3. å¦‚æœ dump æœ¬èº«å¤±è´¥æˆ–ä¸å®Œæ•´ï¼ŒæŸ¥ `kexec-dmesg.log`ã€‚





### åœ¨/etc/default/grubä¸­é…ç½®crashkernel=autoå’Œkdumpæœ‰ä»€ä¹ˆå…³ç³»å‘¢

`crashkernel=auto` å’Œ **kdump** ä¹‹é—´æ˜¯ç´§å¯†ç›¸å…³çš„ï¼š

------

## 1. kdump çš„è¿è¡Œæ¡ä»¶

- kdump è¦æ±‚å†…æ ¸å¯åŠ¨æ—¶ **é¢„ç•™ä¸€éƒ¨åˆ†å†…å­˜**ï¼Œä¸“é—¨ç»™ crash å†…æ ¸ï¼ˆç¬¬äºŒå†…æ ¸ï¼‰ä½¿ç”¨ã€‚
- å¦‚æœæ²¡æœ‰é¢„ç•™å†…å­˜ï¼Œ`kdump.service` å¯åŠ¨æ—¶ä¼šå¤±è´¥ï¼ˆæŠ¥ `No crash kernel memory reservation found`ï¼‰ã€‚

------

## 2. `crashkernel` çš„ä½œç”¨

- è¿™æ˜¯å†…æ ¸å¯åŠ¨å‚æ•°ï¼Œç”¨æ¥å‘Šè¯‰ç³»ç»Ÿï¼šå¯åŠ¨æ—¶ä¸º kdump é¢„ç•™å¤šå°‘å†…å­˜ã€‚
- å¸¸è§é…ç½®æœ‰ï¼š
  - `crashkernel=512M` â†’ å›ºå®šé¢„ç•™ 512MB
  - `crashkernel=2G` â†’ å›ºå®šé¢„ç•™ 2GB
  - `crashkernel=auto` â†’ ç”± RHEL å†…æ ¸é€»è¾‘ **è‡ªåŠ¨å†³å®šé¢„ç•™å¤§å°**

------

## 3. `crashkernel=auto` çš„æœºåˆ¶ï¼ˆRHEL 8 ç‰¹æœ‰å¢å¼ºï¼‰

- ä» RHEL 7.5 å¼€å§‹ï¼ŒRHEL å†…æ ¸æ”¯æŒ `crashkernel=auto`ã€‚

- å…¶é€»è¾‘æ˜¯æ ¹æ®ç³»ç»Ÿæ€»å†…å­˜å¤§å°ï¼Œè‡ªåŠ¨åˆ†é…åˆé€‚çš„é¢„ç•™ç©ºé—´ï¼š

  | ç³»ç»Ÿå†…å­˜å¤§å° | é¢„ç•™ç©ºé—´å¤§å° (çº¦) |
  | ------------ | ----------------- |
  | < 2 GB       | 192 MB            |
  | 2â€“6 GB       | 256 MB            |
  | 6â€“8 GB       | 512 MB            |
  | 8â€“64 GB      | 1 GB              |
  | > 64 GB      | 2 GB æˆ–æ›´å¤š       |

- è¿™æ ·é¿å…äº†ç®¡ç†å‘˜æ‰‹å·¥è®¡ç®—å’Œé…ç½®ã€‚

------

## 4. ä¸¤è€…å…³ç³»æ€»ç»“

- **kdump è¦èƒ½æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»æœ‰ crashkernel é¢„ç•™å†…å­˜**ã€‚
- `crashkernel=auto` å°±æ˜¯è®©å†…æ ¸ **è‡ªåŠ¨é€‰æ‹©**åˆé€‚çš„é¢„ç•™å¤§å°ï¼Œä¿è¯ kdump æ­£å¸¸è¿è¡Œã€‚
- å¦‚æœä¸è®¾ç½® `crashkernel`ï¼Œ`kdump.service` å¯åŠ¨ä¼šå¤±è´¥ï¼Œæ•è·ä¸äº†å†…æ ¸å´©æºƒã€‚
- å¦‚æœé…ç½®äº† `crashkernel=auto`ï¼Œä½ é€šå¸¸ä¸ç”¨å†æ‰‹å·¥æŒ‡å®š `512M` æˆ– `2G`ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ã€‚

------

## 5. éªŒè¯æ–¹æ³•

é‡å¯åï¼ŒæŸ¥çœ‹æ˜¯å¦é¢„ç•™æˆåŠŸï¼š

```
dmesg | grep -i crash
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

```
Kernel command line: ... crashkernel=auto ...
Reserving 512MB of memory at 0x0000000fc000000 for crashkernel
```

------

âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š
 `crashkernel=auto` æ˜¯ä¸º **kdump è‡ªåŠ¨é¢„ç•™å†…å­˜** çš„æ–¹å¼ï¼›æ²¡æœ‰ crashkernelï¼ˆauto æˆ–å›ºå®šå€¼ï¼‰ï¼Œkdump æ— æ³•å·¥ä½œã€‚