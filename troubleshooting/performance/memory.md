stress-ng压测

会启动一个 `vm` worker，分配并保持（`--vm-keep`）大约 **80% 的内存**，持续 600 秒。

```
stress-ng --vm 1 --vm-bytes 80% --vm-keep --timeout 600s

```



然后，使用相关命令检查

```
free -m 
              total        used        free      shared  buff/cache   available
Mem:           1778         935         188          30         654         663
Swap:             0           0           0
```



```
vmstat 1
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 192984   3144 667088    0    0     6     4   76   56  3  0 97  0  0
 2  0      0 192864   3144 667088    0    0     0     0 1154  188 50  0 50  0  0
 1  0      0 192864   3144 667088    0    0     0     0 1117  171 50  0 50  0  0
 1  0      0 192864   3144 667088    0    0     0     0 1134  177 50  0 50  0  0
```



```
sar -r 1 10
Linux 4.18.0-553.el8_10.x86_64 (localhost.localdomain) 	08/25/2025 	_x86_64_	(2 CPU)

04:01:05 AM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
04:01:06 AM    192992    679368   1628132     89.40      3144    623444   1193728     65.55    343936   1138248         8
04:01:07 AM    192992    679368   1628132     89.40      3144    623444   1193728     65.55    343936   1138248         8
04:01:08 AM    192992    679368   1628132     89.40      3144    623444   1193728     65.55    343936   1138248         8
04:01:09 AM    193024    679400   1628100     89.40      3144    623444   1193728     65.55    343936   1138248         8
04:01:10 AM    193024    679400   1628100     89.40      3144    623444   1193728     65.55    343936   1138248         8
04:01:11 AM    193024    679400   1628100     89.40      3144    623444   1193728     65.55    343936   1138248         8

```



## 1. **vmstat 1 输出**

```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 192984   3144 667088    0    0     6     4   76   56  3  0 97  0  0
 2  0      0 192864   3144 667088    0    0     0     0 1154  188 50  0 50  0  0
 1  0      0 192864   3144 667088    0    0     0     0 1117  171 50  0 50  0  0
 ...
```

- **memory 部分**
  - `free ≈ 192MB`，说明绝大多数内存都被占用了（大约 1.7GB 总内存 → 只剩 200MB 左右空闲）。
  - `buff=3MB, cache≈650MB`，这部分是 Linux 用作缓存的。
  - 没有 swap (`swpd=0`, `si=0`, `so=0`) → 说明还没开始换页。
- **CPU 部分**
  - `us=50%，id=50%` → 压测进程大约占用一半 CPU，另一半是空闲。
  - `sy≈0%` → 内核开销很小，没有明显的系统调用负担。
  - `wa=0` → 没有 I/O 等待。
- **r 值**
  - `r=1~2` → 有 1-2 个进程在运行队列里，CPU 可以应付，没出现过载。

✅ 结论：内存已经占用到高位，但没有 swap 压力，CPU 负载稳定。

------

## 2. **free -m 输出**

```
              total        used        free      shared  buff/cache   available
Mem:           1778         933         190          30         654         665
Swap:             0           0           0
```

- 总内存 **1778MB**（≈1.7GB）。
- 已用 **933MB**（应用程序+部分缓存）。
- 空闲 **190MB**。
- 缓存 **654MB** → 系统用来缓存文件页。
- `available=665MB` → Linux 的可用内存（空闲 + 可回收缓存），说明即使只剩 200MB free，系统依然有 ~665MB 可用，不会马上 OOM。
- Swap 没启用。

✅ 结论：系统内存利用率约 **80%**，符合你的压测目标。

------

## 3. **sar -r 1 10 输出**

```
kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
   192992    679368   1628132     89.40      3144    623444   1193728     65.55    343936   1138248         8
```

- **kbmemfree ≈193MB** → 和 `free`、`vmstat` 一致。
- **%memused=89.4%** → 内存使用率接近 90%，达到高压。
- **kbavail ≈679MB** → 系统还可以释放缓存，不算 OOM 边缘。
- **kbcommit=1193728, %commit=65.5%** → 提交内存（应用申请的虚拟内存）约 1.2GB，占系统总量的 65%。说明系统还有余地。
- **kbactive=343MB, kbinact=1138MB** → 活跃内存少，非活跃内存（缓存）多，Linux 可以根据需要释放。
- **kbdirty=8KB** → 脏页很少，说明没有明显的写磁盘压力。

✅ 结论：内存压力达到 90%，但系统依然处于健康状态，没有 swap，没有 OOM，没有 I/O 瓶颈。

------

## 🔎 总体分析

1. **stress-ng 压测正常**
   - 内存使用率接近 80–90%。
   - free memory 很少，但 available 还有 600MB+，安全。
   - 没有触发 swap。
2. **CPU 也有负载**
   - 压测线程吃了 50% CPU。
   - 另一半 CPU 空闲，说明 CPU 不是瓶颈。
3. **系统健康状态**
   - 没有 I/O wait (`wa=0`)。
   - 没有 swap in/out。
   - 没有 OOM。

------

📊 **一句话总结**：
 你这次压测 **确实把系统内存打到了 ~90% 使用率**，剩余的 free 很少，但 Linux 依然可以回收缓存，系统还比较健康。CPU 也参与了一部分计算（50%），但没出现瓶颈。